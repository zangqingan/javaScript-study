{"diagram":{"image":{"x":0,"width":200,"y":0,"pngdata":"iVBORw0KGgoAAAANSUhEUgAAAMgAAADICAYAAACtWK6eAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAsUlEQVR4nO3BAQEAAACCIP+vbkhAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAB8GXHmAAFMgHIEAAAAAElFTkSuQmCC","height":200},"elements":{"leftChildren":[],"note":"","margin":{"childMarginW":10,"childMarginH":5,"marginW":20,"marginH":10},"watermark":"","children":[{"parent":"root","lineStyle":{"lineColor":"#1976D2","lineWidth":"2"},"children":[{"parent":"812b3a9306dd","lineStyle":{"lineColor":"#555","lineWidth":1},"children":[],"style":{"lineStype":{"lineType":"curve","lineColor":"#555","lineWidth":1},"padding":"2px 8px 2px 8px","color":"#2196F3","lineStyle":{"lineColor":"#555","lineWidth":1},"textAlign":"left","font-weight":"normal","font-size":"13px","font-family":"微软雅黑","bold":false,"font-style":"normal","italic":false},"id":"75f8599ad22f","title":"不要直接修改&nbsp;State，而是应该使用&nbsp;setState()，另外构造函数是唯一可以给&nbsp;this.state&nbsp;赋值的地方<br>","icons":[{"color":"rgb(99, 171, 247)","name":"priority","index":"0","text":"&#xe67a"}]},{"parent":"812b3a9306dd","lineStyle":{"lineColor":"#555","lineWidth":1},"children":[{"parent":"0ef2dcae2dae","children":[],"id":"c5f4a9f0ec21","title":"出于性能考虑，React&nbsp;可能会把多个&nbsp;setState()&nbsp;调用合并成一个调用。<br>因为&nbsp;this.props&nbsp;和&nbsp;this.state&nbsp;可能会异步更新，所以你不要依赖他们的值来更新下一个状态"},{"parent":"0ef2dcae2dae","children":[],"id":"5e94de96542c","title":"要解决这个问题，可以让&nbsp;setState()&nbsp;接收一个函数。<br>这个函数用上一个&nbsp;state&nbsp;作为第一个参数，将此次更新被应用时的&nbsp;props&nbsp;做为第二个参数"}],"style":{"lineStype":{"lineColor":"#555","lineWidth":1},"padding":"2px 8px 2px 8px","color":"#2196F3","lineStyle":{"lineColor":"#555","lineWidth":1},"textAlign":"left","font-weight":"normal","font-size":"13px","font-family":"微软雅黑","bold":false,"font-style":"normal","italic":false},"id":"0ef2dcae2dae","title":"State&nbsp;的更新可能是异步的","icons":[{"color":"rgb(113, 203, 45)","name":"priority","index":"1","text":"&#xe625"}]},{"parent":"812b3a9306dd","lineStyle":{"lineColor":"#555","lineWidth":1},"children":[{"parent":"258f12824a28","children":[],"id":"ac6ab2f80a39","title":"当你调用&nbsp;setState()&nbsp;的时候，React&nbsp;会把你提供的对象合并到当前的&nbsp;state"},{"parent":"258f12824a28","children":[{"parent":"68a62f1403ae","note":"  constructor(props) {\n    super(props);\n    this.state = {\n      posts: [],\n      comments: []\n    };\n  }","children":[],"id":"63adb3ded753","title":"你的&nbsp;state&nbsp;包含几个独立的变量"},{"parent":"68a62f1403ae","note":"  componentDidMount() {\n    fetchPosts().then(response =&gt; {\n      this.setState({\n        posts: response.posts\n      });\n    });\n\n    fetchComments().then(response =&gt; {\n      this.setState({\n        comments: response.comments\n      });\n    });\n  }","children":[],"id":"30e4daa81c1b","title":"然后你可以分别调用&nbsp;setState()&nbsp;来单独地更新它们"}],"id":"68a62f1403ae","title":"例如<br>"},{"parent":"258f12824a28","children":[],"id":"c1e7f1b7ce21","title":"这里的合并是浅合并"}],"style":{"lineStype":{"lineColor":"#555","lineWidth":1},"padding":"2px 8px 2px 8px","color":"#2196F3","lineStyle":{"lineColor":"#555","lineWidth":1},"textAlign":"left","font-weight":"normal","font-size":"13px","font-family":"微软雅黑","bold":false,"font-style":"normal","italic":false},"id":"258f12824a28","title":"State&nbsp;的更新会被合并","icons":[{"color":"rgb(255, 159, 26)","name":"priority","index":"2","text":"&#xe62a"}]}],"style":{"padding":"8px 10px 8px 10px","backgroundColor":"#2196F3","color":"#F5F5F5","textAlign":"left","font-weight":"bold","font-size":13,"bold":false,"font-style":"normal","italic":false,"border-radius":"5px","background-color":"#1976D2","lineStype":{"lineType":"curve","lineColor":"#1976D2","lineWidth":"2"},"box-shadow":"1px 2px 6px #aaa","lineStyle":{"lineColor":"#1976D2","lineWidth":"2"},"font-family":"微软雅黑","border-width":0,"border-style":"solid"},"id":"812b3a9306dd","title":"正确使用State<br>"},{"parent":"root","lineStyle":{"randomLineColor":"rgb(153,204,255)","lineColor":"#F57F17"},"children":[{"parent":"b653f7534587","lineStyle":{"lineColor":"#555","lineWidth":1},"children":[],"style":{"lineStype":{"lineType":"curve","lineColor":"#555","lineWidth":1},"padding":"2px 8px 2px 8px","color":"#666","lineStyle":{"lineColor":"#555","lineWidth":1},"textAlign":"left","font-weight":"normal","font-size":"13px","font-family":"微软雅黑","bold":false,"font-style":"normal","italic":false},"id":"4e45887e5c5d","title":"不管是父组件或是子组件都无法知道某个组件是有状态的还是无状态的，并且它们也并不关心它是函数组件还是&nbsp;class&nbsp;组件。<br>这就是为什么称&nbsp;state&nbsp;为局部的或是封装的的原因。除了拥有并设置了它的组件，其他组件都无法访问。","icons":[{"color":"rgb(99, 171, 247)","name":"priority","index":"0","text":"&#xe67a"}]},{"parent":"b653f7534587","lineStyle":{"lineColor":"#555","lineWidth":1},"children":[],"style":{"lineStype":{"lineType":"curve","lineColor":"#555","lineWidth":1},"padding":"2px 8px 2px 8px","color":"#666","lineStyle":{"lineColor":"#555","lineWidth":1},"textAlign":"left","font-weight":"normal","font-size":"13px","font-family":"微软雅黑","bold":false,"font-style":"normal","italic":false},"id":"464cdf10b55a","title":"组件可以选择把它的&nbsp;state&nbsp;作为&nbsp;props&nbsp;向下传递到它的子组件中<br>","icons":[{"color":"rgb(113, 203, 45)","name":"priority","index":"1","text":"&#xe625"}]},{"parent":"b653f7534587","lineStyle":{"lineColor":"#555","lineWidth":1},"children":[],"style":{"lineStype":{"lineType":"curve","lineColor":"#555","lineWidth":1},"padding":"2px 8px 2px 8px","color":"#666","lineStyle":{"lineColor":"#555","lineWidth":1},"textAlign":"left","font-weight":"normal","font-size":"13px","font-family":"微软雅黑","bold":false,"font-style":"normal","italic":false},"id":"df19231a906c","title":"但是组件本身无法知道它是来自于谁的&nbsp;state，或是谁的&nbsp;props，还是手动输入的<br>","icons":[{"color":"rgb(255, 159, 26)","name":"priority","index":"2","text":"&#xe62a"}]},{"parent":"b653f7534587","lineStyle":{"lineColor":"#555","lineWidth":1},"children":[],"style":{"lineStype":{"lineColor":"#555","lineWidth":1},"padding":"2px 8px 2px 8px","color":"#F57F17","lineStyle":{"lineColor":"#555","lineWidth":1},"textAlign":"left","font-weight":"normal","font-size":"13px","font-family":"微软雅黑","font-style":"normal"},"id":"a3821005fcb2","title":"这通常会被叫做“自上而下”或是“单向”的数据流。任何的&nbsp;state&nbsp;总是所属于特定的组件，而且从该&nbsp;state&nbsp;派生的任何数据或&nbsp;UI&nbsp;只能影响树中“低于”它们的组件","icons":[{"color":"rgb(48, 191, 191)","name":"priority","index":"3","text":"&#xe635"}]},{"parent":"b653f7534587","note":"","children":[],"id":"be2111c6884d","title":"如果把一个以组件构成的树想象成一个&nbsp;props&nbsp;的数据瀑布的话，那么每一个组件的&nbsp;state&nbsp;就像是在任意一点上给瀑布增加额外的水源，但是它只能向下流动","icons":[{"color":"rgb(68, 68, 68)","name":"priority","index":"4"}]},{"parent":"b653f7534587","children":[],"id":"9823ad0e8de5","title":"在&nbsp;React&nbsp;应用中，组件是有状态组件还是无状态组件属于组件实现的细节，它可能会随着时间的推移而改变。你可以在有状态的组件中使用无状态的组件，反之亦然","icons":[{"color":"rgb(68, 68, 68)","name":"priority","index":"5"}]}],"style":{"background-color":"#F57F17","border-radius":"5px","color":"rgb(255, 255, 255)","font-weight":"bold","font-size":13,"border-color":"rgb(255, 255, 255)","border-width":"0px","border-style":"none"},"id":"b653f7534587","title":"数据是向下流动的"}],"root":true,"theme":"customise_7fd055efa78b","style":{"background-color":"rgb(255, 83, 92)","border-radius":"6px","color":"rgb(255, 255, 255)","font-weight":"bold","border-color":"rgb(255, 255, 255)","border-width":"0px","border-style":"none"},"id":"root","title":"数据流和正确使用State<br>","icons":[{"color":"rgb(255, 255, 255)","name":"","index":"38"}],"structure":"mind_free"}},"meta":{"exportTime":"2022-04-01 14:50:07","member":"60cca488e0b34d55bbf2954f","diagramInfo":{"creator":"60cca488e0b34d55bbf2954f","created":"2022-03-16 11:13:49","modified":"2022-04-01 14:49:37","title":"2.4.2数据流和正确使用State","category":"mind_free"},"id":"623155edf346fb07f9300fdd","type":"ProcessOn Schema File","version":"1.0"}}